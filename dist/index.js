var t={inject:["system"],props:{value:String,interface:String,collection:String,field:String,interfaceOptions:Array,type:String},data:function(){return{result:null,isLoading:!0}},methods:{requestData:async function(t){let e=["languages_code"];return Object.keys(t.paths).map((t=>{e.push(this.field+"."+t),e.push(this.field+"."+t.split(".").slice(0,-1).join(".")+".languages_code")})),(await this.system.api.get(`/items/${this.collection}?fields=${e.join(",")}&filter[${this.field}][id][_in]=${Array.isArray(this.value)?this.value.join(","):this.value}`)).data.data[0]},parseTemplate:function(t){const e={template:t.replace(/\{\{\t?([a-z0-9_\.]+)\t?\}\}/gi,"{{$1}}"),maxDepth:0,paths:{}};return(e.template.match(/\{\{\t?[a-z0-9_\.]+\t?\}\}/gi)||[]).forEach((t=>{t=t.substring(2,t.length-2),e.paths[t]=!0,e.maxDepth=Math.max(e.maxDepth,t.split(".").length)})),e.paths=e.paths,e},filterLang:function(t){for(let e in t)if("string"==typeof t[e].languages_code&&t[e].languages_code===this.system.useUserStore().state.currentUser.language)return t[e];return t[0]},resolvePath:function(t,e,n){if(n=n||0,e.length===n)return t;if("object"==typeof t){if(Array.isArray(t)){if(t.length>0){if("translations"===e[n-1])return this.resolvePath(this.filterLang(t),e,n);{let r=[];return t.forEach(((t,a)=>{r.push(this.resolvePath(t,e,n))})),r.join(",")}}return null}return void 0!==t[e[n]]?this.resolvePath(t[e[n]],e,n+1):null}return null}},created:async function(){const t=this.parseTemplate(this.$attrs.template),e=await this.requestData(t);let n;for(let r in t.paths)n=r.split("."),n.unshift(this.field),t.paths[r]=this.resolvePath(e,n),t.compiled=t.template.replaceAll(`{{${r}}}`,t.paths[r]).trim();this.result=t.compiled,this.isLoading=!1}};function e(t,e,n,r,a,s,i,l,o,p){"boolean"!=typeof i&&(o=l,l=i,i=!1);const u="function"==typeof n?n.options:n;let d;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,a&&(u.functional=!0)),r&&(u._scopeId=r),s?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,o(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=d):e&&(d=i?function(t){e.call(this,p(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,l(t))}),d)if(u.functional){const t=u.render;u.render=function(e,n){return d.call(n),t(e,n)}}else{const t=u.beforeCreate;u.beforeCreate=t?[].concat(t,d):[d]}return n}const n="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function r(t){return(t,e)=>function(t,e){const r=n?e.media||"default":t,i=s[r]||(s[r]={ids:new Set,styles:[]});if(!i.ids.has(t)){i.ids.add(t);let n=e.source;if(e.map&&(n+="\n/*# sourceURL="+e.map.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",e.media&&i.element.setAttribute("media",e.media),void 0===a&&(a=document.head||document.getElementsByTagName("head")[0]),a.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(n),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{const t=i.ids.size-1,e=document.createTextNode(n),r=i.element.childNodes;r[t]&&i.element.removeChild(r[t]),r.length?i.element.insertBefore(e,r[t]):i.element.appendChild(e)}}}(t,e)}let a;const s={};const i=t;var l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.result?n("span",[t._v(t._s(t.result))]):t.isLoading?n("span",{staticClass:"null"},[t._v("Loading...")]):n("span",{staticClass:"null"},[t._v("--")])};l._withStripped=!0;var o={id:"directus-translations-display",name:"Trunslations display",description:"Custom translations display for Directus 9.",icon:"box",handler:e({render:l,staticRenderFns:[]},(function(t){t&&t("data-v-5c3b3eea_0",{source:".null[data-v-5c3b3eea] {\n  color: var(--border-normal);\n}\n\n/*# sourceMappingURL=display.vue.map */",map:{version:3,sources:["C:\\Users\\progr0\\Downloads\\directus-translations-display\\src\\display.vue","display.vue"],names:[],mappings:"AAoKA;EACA,2BAAA;ACnKA;;AAEA,sCAAsC",file:"display.vue",sourcesContent:["<template>\r\n\t<span v-if=\"result\">{{ result }}</span>\r\n\t<span v-else-if=\"isLoading\" class=\"null\">Loading...</span>\r\n\t<span v-else class=\"null\">--</span>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tinject: [\"system\"],\r\n\tprops: {\r\n\t\tvalue: String,\r\n\t\tinterface: String,\r\n\t\tcollection: String,\r\n\t\tfield: String,\r\n\t\tinterfaceOptions: Array,\r\n\t\ttype: String\r\n\t},\r\n\tdata : function ()\r\n\t{\r\n\t\treturn {\r\n\t\t\tresult : null,\r\n\t\t\tisLoading : true\r\n\t\t};\r\n\t},\r\n\tmethods: {\r\n\t\trequestData : async function (_template)\r\n\t\t{\r\n\t\t\tlet fields = ['languages_code'];\r\n\t\t\t\r\n\t\t\tObject.keys(_template.paths).map(_item =>\r\n\t\t\t{\r\n\t\t\t\tfields.push(this.field + '.' + _item);\r\n\t\t\t\tfields.push(this.field + '.' + _item.split('.').slice(0, -1).join('.') + '.languages_code');\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tlet data = await this.system.api.get(`/items/${this.collection}?fields=${fields.join(',')}&filter[${this.field}][id][_in]=${Array.isArray(this.value) ? this.value.join(',') : this.value}`);\r\n\t\t\t\r\n\t\t\treturn data.data.data[0];\r\n\t\t},\r\n\t\tparseTemplate : function (_template)\r\n\t\t{\r\n\t\t\tconst result = {\r\n\t\t\t\ttemplate : _template.replace(/\\{\\{\\t?([a-z0-9_\\.]+)\\t?\\}\\}/ig, '{{$1}}'),\r\n\t\t\t\tmaxDepth : 0,\r\n\t\t\t\tpaths : {}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tconst matches = result.template.match(/\\{\\{\\t?[a-z0-9_\\.]+\\t?\\}\\}/ig) || [];\r\n\t\t\t\r\n\t\t\tmatches.forEach(_item => \r\n\t\t\t{\r\n\t\t\t\t_item = _item.substring(2, _item.length - 2);\r\n\t\t\t\t\r\n\t\t\t\tresult.paths[_item] = true;\r\n\t\t\t\tresult.maxDepth = Math.max(result.maxDepth, _item.split('.').length);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tresult.paths = result.paths;\r\n\t\t\t\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tfilterLang : function (_array)\r\n\t\t{\r\n\t\t\tfor (let i in _array)\r\n\t\t\t{\r\n\t\t\t\tif (typeof _array[i].languages_code === 'string' &&\r\n\t\t\t\t\t_array[i].languages_code === this.system.useUserStore().state.currentUser.language\r\n\t\t\t\t)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn _array[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn _array[0];\r\n\t\t},\r\n\t\tresolvePath : function (_data, _path, _level)\r\n\t\t{\r\n\t\t\t_level = _level || 0;\r\n\t\t\t\r\n\t\t\tif (_path.length === _level)\r\n\t\t\t{\r\n\t\t\t\treturn _data;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof _data === 'object')\r\n\t\t\t{\r\n\t\t\t\tif (Array.isArray(_data))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_data.length > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (_path[_level - 1] === 'translations')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn this.resolvePath(\r\n\t\t\t\t\t\t\t\tthis.filterLang(_data),\r\n\t\t\t\t\t\t\t\t_path,\r\n\t\t\t\t\t\t\t\t_level\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet array = [];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t_data.forEach((_item, _index) =>\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tarray.push(\r\n\t\t\t\t\t\t\t\t\tthis.resolvePath(\r\n\t\t\t\t\t\t\t\t\t\t_item,\r\n\t\t\t\t\t\t\t\t\t\t_path,\r\n\t\t\t\t\t\t\t\t\t\t_level\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treturn array.join(',');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (typeof _data[_path[_level]] !== 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn this.resolvePath(\r\n\t\t\t\t\t\t\t_data[_path[_level]],\r\n\t\t\t\t\t\t\t_path,\r\n\t\t\t\t\t\t\t_level + 1\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\tcreated : async function ()\r\n\t{\r\n\t\tconst template_ = this.parseTemplate(this.$attrs.template);\r\n\t\tconst data = await this.requestData(template_);\r\n\t\t\r\n\t\tlet pathArray;\r\n\t\t\r\n\t\tfor (let path in template_.paths)\r\n\t\t{\r\n\t\t\tpathArray = path.split('.');\r\n\t\t\tpathArray.unshift(this.field);\r\n\t\t\t\r\n\t\t\ttemplate_.paths[path] = this.resolvePath(data, pathArray);\r\n\t\t\ttemplate_.compiled = template_.template.replaceAll(`{{${path}}}`, template_.paths[path]).trim();\r\n\t\t}\r\n\t\t\r\n\t\tthis.result = template_.compiled;\r\n\t\tthis.isLoading = false;\r\n\t}\r\n};\r\n<\/script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.null {\r\n\tcolor: var(--border-normal);\r\n}\r\n</style>",".null {\n  color: var(--border-normal);\n}\n\n/*# sourceMappingURL=display.vue.map */"]},media:void 0})}),i,"data-v-5c3b3eea",false,undefined,!1,r,void 0,void 0),types:["alias","string","uuid","integer","bigInteger","json"],options:[{field:"template",name:"Display template",type:"string",meta:{interface:"text-input",width:"full"}}]};export default o;
